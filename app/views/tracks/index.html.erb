<div class="section grey lighten-3">
 <div class="container">
  <div class="card-panel">
   <div class="row">
    <div class="col s12">
        <h4>Manage Tracks</h4><hr>
      </div>
     </div>
   <%= form_tag project_album_delete_media_path, method: :delete do %>
      <div class="row">
        <div class="col s12">
           <span>
            <button data-target="modal1" class="btn modal-trigger">Upload</button>
              <%= submit_tag "Delete", id: "delete", class: "btn btn-danger", disabled: @tracks.empty? %>
              </span>
            </div>
          </div>
       </div>


      <div class="card-panel">
         <% if @tracks.empty? %>
             <div class="row">
                  <div class="col s12">
                <h5 id="no-media">No Media Found</h5>
                </div>
              </div>
              <% else %>
         <div id="media-contents">
       
         <table class="highlight edit-tracks-index">
        <thead>
          <tr>
              <th data-field="id">#</th>
              <th data-field="name">Title</th>
              <th data-field="price">Delete</th>
          </tr>
        </thead>

          <% @tracks.each do |media| %>
   
         <tbody>
          <tr>
            <td>2</td>
            <td>  <%= media.file_name.url %> </td>
            <td><p><%= check_box_tag "tracks[]", media.id, false, :id => "#{media.id}" %>
                  <label for="<%= media.id %>">Delete</label></p></td>
           </tr>      
               <% end %>
                 </tbody>
                </table>
                </div>
              <% end %>
            </div>
          </div>
       <% end %>
      </div>
    </div>

 

<!-- Modal Structure -->
  <div id="modal1" class="modal modal-fixed-footer">
    <div class="modal-content">
      <h4>Track Upload</h4>
    <%= form_for [@project, @album, @track], url: {action: "create"}, html: {class: "dropzone", id: "media-dropzone"} do |f| %>
      <%= hidden_field :project_id, multiple: true %>
    <%= hidden_field :album_id, multiple: true %>
  <div class="fallback">
    <%= file_field :file_name, multiple: true %>
    <%= hidden_field :project_id, multiple: true %>
    <%= hidden_field :album_id, multiple: true %>

  </div>
<% end %> 
    </div>
    <div class="modal-footer">
      <a href="#!" class="modal-action modal-close waves-effect waves-green btn-flat ">Cancel</a>
    </div>
  </div>

<script type="text/javascript">
	  $(document).ready(function(){
    // the "href" attribute of .modal-trigger must specify the modal ID that wants to be triggered
    $('.modal-trigger').leanModal();
  });
</script>

<script type="text/javascript">
$(function() {
  var mediaDropzone;
  mediaDropzone = new Dropzone("#media-dropzone");
  return mediaDropzone.on("success", function(file, responseText) {
    var _this = this;
    appendContent(responseText.file_name.url, responseText.id);
    $(function(){
     $('#modal1').closeModal();
     $('div.lean-overlay').remove();
    });
  });
});

var appendContent = function(trackUrl, trackId) {
  $("#media-contents").append('<div class="col row">' + 
    '<ul class="collection">' + '<li class="collection-item"/>' + trackUrl);
  $("#delete").removeAttr('disabled');
  $("#no-media").html("");
};
</script>